ReviewReport_v1:
  global_findings:
    - severity: high
      area: security
      description: "Backend API enables `allow_credentials` CORS with `*` origins, leaving token-auth endpoints susceptible to browser-based CSRF." 
      evidence:
        - "F:backend/app.py†L35-L58"
      recommendation: "Restrict `allow_origins` to explicit hosts, disable credentials for public origins, and introduce CSRF tokens or API-gateway enforcement before exposing the service."
    - severity: high
      area: security
      description: "Demo tooling seeds hard-coded API tokens and encryption keys that could leak into non-demo environments if environment management is misconfigured."
      evidence:
        - "F:fixops/demo_runner.py†L16-L29"
      recommendation: "Scope demo secrets via `.env.demo` or fixture loader that refuses to run when `mode!=demo`, and ensure production overlays require externally managed secrets."
    - severity: high
      area: infra
      description: "Enterprise Docker image ships with auth disabled and Kubernetes manifests reference placeholder secrets plus `:latest` images, risking accidental production deployment without controls."
      evidence:
        - "F:fixops-blended-enterprise/Dockerfile†L56-L71"
        - "F:fixops-blended-enterprise/kubernetes/secret.yaml†L7-L18"
        - "F:fixops-blended-enterprise/kubernetes/backend-deployment.yaml†L27-L32"
      recommendation: "Split demo vs. production compose; ensure images use immutable tags, require real secret stores, and fail fast when `FIXOPS_AUTH_DISABLED` is true outside sandbox builds."
    - severity: medium
      area: supply_chain
      description: "Python dependencies are only minimally constrained and include a direct GitHub reference, hampering reproducible builds and provenance checks." 
      evidence:
        - "F:backend/requirements.txt†L1-L7"
      recommendation: "Adopt lockfiles (pip-tools/uv/poetry) with hashes, replace VCS dependencies with vendored tarballs or release packages, and integrate SBOM generation."
  components:
    - name: backend
      findings:
        - severity: medium
          area: correctness
          description: "Ingestion endpoints rely on in-memory archive state but do not guard against concurrent uploads overwriting `app.state.artifacts`."
          evidence:
            - "F:backend/app.py†L80-L165"
          recommendation: "Isolate artefacts per run ID (e.g., session tokens) or require clients to stage inputs with unique identifiers before pipeline execution."
        - severity: medium
          area: resilience
          description: "`_read_limited` streams uploads but does not cap FastAPI worker concurrency or enforce per-stage timeouts, risking resource exhaustion under parallel submissions."
          evidence:
            - "F:backend/app.py†L93-L123"
          recommendation: "Add request-level timeouts, tune worker count, and consider rate limiting or background tasks for large artefacts."
    - name: fixops
      findings:
        - severity: medium
          area: security
          description: "Overlay loader automatically deep-merges arbitrary dictionaries, so unvalidated keys in user-supplied overlays could toggle modules without audit." 
          evidence:
            - "F:fixops/configuration.py†L45-L99"
          recommendation: "Constrain overrides via explicit schema or pydantic models and reject unexpected keys per module to avoid silent capability drift."
        - severity: low
          area: operability
          description: "CLI persists artefacts and evidence without guarding against overwriting existing bundles, which may erase prior runs during demos."
          evidence:
            - "F:fixops/cli.py†L258-L307"
          recommendation: "Include timestamped subdirectories or `--force` flag before overwriting archived bundles."
    - name: fixops-blended-enterprise
      findings:
        - severity: medium
          area: infra
          description: "Terraform backend hard-codes S3 bucket/key names and expects credentials out-of-band, creating risk of state collisions across tenants."
          evidence:
            - "F:fixops-blended-enterprise/terraform/main.tf†L17-L53"
          recommendation: "Parameterise backend configuration or document per-environment overrides; enforce unique bucket prefixes and encryption."
        - severity: medium
          area: networking
          description: "Ingress exposes multiple public hostnames without rate limits or WAF annotations, widening the attack surface for experimental services."
          evidence:
            - "F:fixops-blended-enterprise/kubernetes/ingress.yaml†L19-L56"
          recommendation: "Tighten host mappings, add WAF/IPS annotations, and enforce mutual TLS or private ingress for non-public components."
