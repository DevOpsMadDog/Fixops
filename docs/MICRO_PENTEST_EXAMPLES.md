# Enterprise Micro Penetration Testing - Example Configurations

This directory contains example configurations for various micro pen testing scenarios.

## Example 1: API Security Assessment

```json
{
  "name": "E-Commerce API Security Scan",
  "attack_surface": {
    "name": "E-Commerce REST API",
    "target_url": "https://api.ecommerce.example.com",
    "target_type": "api",
    "endpoints": [
      "/api/v1/products",
      "/api/v1/cart",
      "/api/v1/checkout",
      "/api/v1/users",
      "/api/v1/auth/login",
      "/api/v1/auth/register",
      "/api/v1/payments"
    ],
    "authentication_required": true,
    "authentication_type": "jwt",
    "headers": {
      "Content-Type": "application/json",
      "User-Agent": "FixOps-Pentest/1.0"
    },
    "environment": "staging",
    "technologies": ["Node.js", "Express", "PostgreSQL", "Redis"]
  },
  "threat_model": {
    "name": "OWASP API Security Top 10",
    "description": "Comprehensive API security testing based on OWASP API Security Top 10",
    "categories": [
      "initial_access",
      "credential_access",
      "privilege_escalation",
      "defense_evasion"
    ],
    "attack_vectors": [
      "sql_injection",
      "authentication_bypass",
      "authorization_bypass",
      "api_abuse",
      "secrets_exposure"
    ],
    "mitre_techniques": ["T1190", "T1078", "T1548"],
    "owasp_categories": [
      "A01:2021-Broken Access Control",
      "A02:2021-Cryptographic Failures",
      "A03:2021-Injection",
      "A07:2021-Identification and Authentication Failures"
    ],
    "priority": 9,
    "compliance_frameworks": ["owasp_top_10", "soc2", "pci_dss"]
  },
  "scan_mode": "active",
  "timeout_seconds": 600,
  "max_threads": 5,
  "rate_limit_rps": 10,
  "stop_on_critical": true,
  "include_proof_of_concept": true,
  "tags": ["api", "ecommerce", "staging", "automated"]
}
```

## Example 2: Web Application Security Test

```json
{
  "name": "Admin Portal Security Assessment",
  "attack_surface": {
    "name": "Admin Dashboard",
    "target_url": "https://admin.example.com",
    "target_type": "web_app",
    "endpoints": [
      "/login",
      "/dashboard",
      "/users/manage",
      "/settings",
      "/reports",
      "/logs"
    ],
    "authentication_required": true,
    "authentication_type": "session",
    "cookies": {
      "session_id": "test_session_token"
    },
    "environment": "staging",
    "technologies": ["React", "Django", "MySQL"]
  },
  "threat_model": {
    "name": "Web Application Security",
    "description": "Comprehensive web application security testing",
    "categories": [
      "initial_access",
      "persistence",
      "privilege_escalation",
      "credential_access"
    ],
    "attack_vectors": [
      "xss",
      "csrf",
      "sql_injection",
      "authentication_bypass",
      "authorization_bypass",
      "session_hijacking"
    ],
    "mitre_techniques": ["T1190", "T1185", "T1539"],
    "owasp_categories": [
      "A01:2021-Broken Access Control",
      "A03:2021-Injection",
      "A05:2021-Security Misconfiguration",
      "A07:2021-Identification and Authentication Failures"
    ],
    "priority": 10,
    "compliance_frameworks": ["owasp_top_10", "soc2"]
  },
  "scan_mode": "active",
  "timeout_seconds": 900,
  "max_threads": 3,
  "rate_limit_rps": 5,
  "stop_on_critical": true,
  "include_proof_of_concept": true,
  "tags": ["web-app", "admin", "high-priority"]
}
```

## Example 3: Infrastructure Security Scan

```json
{
  "name": "Cloud Infrastructure Security Assessment",
  "attack_surface": {
    "name": "AWS Production Environment",
    "target_url": "https://prod.example.com",
    "target_type": "infrastructure",
    "endpoints": [
      "/health",
      "/metrics",
      "/api/status"
    ],
    "authentication_required": false,
    "environment": "production",
    "technologies": ["AWS", "Kubernetes", "Nginx", "Docker"],
    "metadata": {
      "cloud_provider": "aws",
      "region": "us-east-1",
      "vpc_id": "vpc-12345"
    }
  },
  "threat_model": {
    "name": "Cloud Infrastructure Security",
    "description": "Infrastructure and cloud misconfiguration testing",
    "categories": [
      "initial_access",
      "defense_evasion",
      "discovery",
      "lateral_movement"
    ],
    "attack_vectors": [
      "cloud_misconfiguration",
      "configuration_error",
      "secrets_exposure",
      "container_escape"
    ],
    "mitre_techniques": ["T1190", "T1021", "T1610"],
    "priority": 9,
    "compliance_frameworks": ["cis", "nist_800_53", "soc2"]
  },
  "scan_mode": "passive",
  "timeout_seconds": 300,
  "max_threads": 2,
  "rate_limit_rps": 3,
  "stop_on_critical": true,
  "include_proof_of_concept": false,
  "tags": ["infrastructure", "cloud", "aws", "production"]
}
```

## Example 4: CI/CD Pipeline Security

```json
{
  "name": "CI/CD Pipeline Security Scan",
  "attack_surface": {
    "name": "GitHub Actions Pipeline",
    "target_url": "https://api.github.com",
    "target_type": "api",
    "endpoints": [
      "/repos/org/repo/actions/workflows",
      "/repos/org/repo/actions/secrets",
      "/repos/org/repo/contents"
    ],
    "authentication_required": true,
    "authentication_type": "token",
    "headers": {
      "Authorization": "token ${GITHUB_TOKEN}",
      "Accept": "application/vnd.github.v3+json"
    },
    "environment": "production",
    "technologies": ["GitHub Actions", "Docker"]
  },
  "threat_model": {
    "name": "CI/CD Security",
    "description": "Supply chain and CI/CD security testing",
    "categories": [
      "initial_access",
      "execution",
      "persistence",
      "credential_access"
    ],
    "attack_vectors": [
      "secrets_exposure",
      "dependency_vulnerability",
      "configuration_error",
      "command_injection"
    ],
    "mitre_techniques": ["T1195", "T1059", "T1552"],
    "priority": 10,
    "compliance_frameworks": ["soc2", "nist_800_53"]
  },
  "scan_mode": "passive",
  "timeout_seconds": 300,
  "max_threads": 2,
  "rate_limit_rps": 5,
  "stop_on_critical": false,
  "include_proof_of_concept": true,
  "tags": ["cicd", "supply-chain", "github"]
}
```

## Example 5: Compliance-Focused Scan

```json
{
  "name": "SOC2 Compliance Validation",
  "attack_surface": {
    "name": "Customer Data API",
    "target_url": "https://api.customer.example.com",
    "target_type": "api",
    "endpoints": [
      "/api/v1/customers",
      "/api/v1/orders",
      "/api/v1/billing",
      "/api/v1/support"
    ],
    "authentication_required": true,
    "authentication_type": "oauth2",
    "environment": "production",
    "technologies": ["Python", "FastAPI", "PostgreSQL"],
    "metadata": {
      "data_classification": "pii",
      "compliance_scope": "soc2_type2"
    }
  },
  "threat_model": {
    "name": "SOC2 Security Controls",
    "description": "Validate SOC2 security control effectiveness",
    "categories": [
      "initial_access",
      "credential_access",
      "collection",
      "exfiltration"
    ],
    "attack_vectors": [
      "authentication_bypass",
      "authorization_bypass",
      "api_abuse",
      "cryptographic_weakness"
    ],
    "priority": 10,
    "compliance_frameworks": ["soc2", "iso27001", "gdpr"],
    "expected_findings": [
      "No critical authentication vulnerabilities",
      "Proper encryption at rest and in transit",
      "Audit logging enabled",
      "Rate limiting implemented"
    ]
  },
  "scan_mode": "passive",
  "timeout_seconds": 600,
  "max_threads": 3,
  "rate_limit_rps": 5,
  "stop_on_critical": true,
  "include_proof_of_concept": true,
  "tags": ["compliance", "soc2", "production", "pii"]
}
```

## Example 6: Mobile API Backend

```json
{
  "name": "Mobile App Backend Security",
  "attack_surface": {
    "name": "Mobile API",
    "target_url": "https://mobile-api.example.com",
    "target_type": "api",
    "endpoints": [
      "/api/v2/auth/mobile",
      "/api/v2/profile",
      "/api/v2/feed",
      "/api/v2/messages",
      "/api/v2/settings"
    ],
    "authentication_required": true,
    "authentication_type": "jwt",
    "headers": {
      "X-Device-ID": "test-device-001",
      "X-App-Version": "2.1.0",
      "X-Platform": "android"
    },
    "environment": "staging",
    "technologies": ["Node.js", "MongoDB", "Redis"],
    "metadata": {
      "client_type": "mobile",
      "platforms": ["ios", "android"]
    }
  },
  "threat_model": {
    "name": "Mobile Backend Security",
    "description": "Mobile API security testing focused on mobile-specific threats",
    "categories": [
      "initial_access",
      "credential_access",
      "collection",
      "exfiltration"
    ],
    "attack_vectors": [
      "authentication_bypass",
      "api_abuse",
      "cryptographic_weakness",
      "secrets_exposure",
      "session_hijacking"
    ],
    "mitre_techniques": ["T1078", "T1539", "T1552"],
    "owasp_categories": [
      "M1: Improper Platform Usage",
      "M2: Insecure Data Storage",
      "M3: Insecure Communication",
      "M4: Insecure Authentication"
    ],
    "priority": 8,
    "compliance_frameworks": ["owasp_top_10"]
  },
  "scan_mode": "active",
  "timeout_seconds": 450,
  "max_threads": 5,
  "rate_limit_rps": 15,
  "stop_on_critical": true,
  "include_proof_of_concept": true,
  "tags": ["mobile", "api", "staging"]
}
```

## Usage

### Using cURL

```bash
# Save configuration to file
cat > scan-config.json << 'EOF'
{
  "name": "My Security Scan",
  ...
}
EOF

# Create scan
curl -X POST http://localhost:8000/api/v1/micro-pentest/scans \
  -H "Authorization: Bearer $TOKEN" \
  -H "X-Tenant-ID: $TENANT_ID" \
  -H "Content-Type: application/json" \
  -d @scan-config.json
```

### Using Python

```python
import json
import requests

# Load configuration
with open('scan-config.json', 'r') as f:
    config = json.load(f)

# Create scan
response = requests.post(
    'http://localhost:8000/api/v1/micro-pentest/scans',
    headers={
        'Authorization': f'Bearer {token}',
        'X-Tenant-ID': tenant_id,
        'Content-Type': 'application/json',
    },
    json=config,
)

scan = response.json()
print(f"Created scan: {scan['scan_id']}")
```

## Best Practices

1. **Start with Passive Mode**: Always begin with passive scanning in production
2. **Gradual Escalation**: Move from passive → active → aggressive in lower environments
3. **Rate Limiting**: Set conservative rate limits to avoid overwhelming targets
4. **Scope Definition**: Define precise attack surface to avoid testing unintended targets
5. **Compliance Alignment**: Map scans to relevant compliance frameworks
6. **Tag Organization**: Use tags for easy scan organization and filtering
7. **Environment Separation**: Use different configurations for different environments
8. **Continuous Testing**: Integrate scans into CI/CD for continuous validation

## Customization

### Custom Threat Models

Create custom threat models for specific business requirements:

```json
{
  "threat_model": {
    "name": "Payment Processing Security",
    "description": "PCI-DSS focused payment security testing",
    "categories": ["credential_access", "collection", "exfiltration"],
    "attack_vectors": [
      "sql_injection",
      "cryptographic_weakness",
      "secrets_exposure",
      "api_abuse"
    ],
    "priority": 10,
    "compliance_frameworks": ["pci_dss"],
    "test_cases": [
      "Test encryption strength for card data",
      "Validate key management practices",
      "Test access controls for payment endpoints",
      "Verify audit logging for payment transactions"
    ]
  }
}
```

### Custom Attack Surface

Define detailed attack surfaces:

```json
{
  "attack_surface": {
    "name": "Multi-Service Architecture",
    "target_url": "https://api.example.com",
    "target_type": "api",
    "endpoints": [
      "/api/v1/service-a/*",
      "/api/v1/service-b/*",
      "/api/v1/gateway/*"
    ],
    "parameters": {
      "test_user_id": "test123",
      "api_version": "v1"
    },
    "metadata": {
      "architecture": "microservices",
      "service_mesh": "istio",
      "api_gateway": "kong"
    }
  }
}
```
