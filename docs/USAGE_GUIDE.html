<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>FixOps Usage Guide</title>
  <style>
    body { font-family: "Segoe UI", Roboto, sans-serif; margin: 2.5rem auto; max-width: 960px; line-height: 1.6; color: #14213d; }
    h1, h2, h3 { color: #0b2545; }
    h1 { text-align: center; }
    .hero { background: #f0f4f8; border-radius: 12px; padding: 1.5rem 2rem; margin-bottom: 2rem; }
    .hero strong { display: block; font-size: 1.2rem; }
    section { margin-bottom: 3rem; }
    code, pre { font-family: "Fira Code", Consolas, monospace; }
    pre { background: #f8fafc; border-radius: 10px; padding: 1rem; overflow-x: auto; border: 1px solid #e2e8f0; }
    ul { padding-left: 1.4rem; }
    table { width: 100%; border-collapse: collapse; margin: 1.5rem 0; }
    th, td { border: 1px solid #d2d8e4; padding: 0.7rem; text-align: left; }
    th { background: #edf2fb; }
    .timeline { display: grid; gap: 1rem; }
    .timeline-step { border-left: 4px solid #1d4ed8; padding-left: 1rem; background: #f8fafc; border-radius: 4px; }
    .badge { display: inline-block; padding: 0.2rem 0.6rem; border-radius: 999px; font-size: 0.75rem; background: #1d4ed8; color: #fff; margin-right: 0.4rem; }
    .callout { border-left: 4px solid #f59e0b; background: #fff7ed; padding: 1rem 1.25rem; border-radius: 6px; margin: 1.5rem 0; }
    a { color: #1d4ed8; text-decoration: none; }
    a:hover { text-decoration: underline; }
    footer { font-size: 0.85rem; color: #475569; margin-top: 4rem; text-align: center; }
  </style>
</head>
<body>
  <h1>FixOps Usage Guide</h1>
  <div class="hero">
    <strong>Mission</strong>
    <p>Deliver contextual risk, guardrail automation, and audit-ready evidence in &lt;30 minutes for demo teams while scaling to enterprise governance through the same overlay-driven platform.</p>
    <p><span class="badge">Demo</span>One-click bootstrap via provided overlay profile. <span class="badge">Enterprise</span>Layer in integrations, compliance packs, and automation by flipping overlay switches.</p>
  </div>

  <section id="map">
    <h2>Where FixOps Runs</h2>
    <table>
      <thead>
        <tr>
          <th>Surface</th>
          <th>Purpose</th>
          <th>Quick Link</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>FastAPI service</td>
          <td>Receives artefact uploads, executes overlay-selected modules, emits responses + evidence</td>
          <td><code>backend/app.py</code></td>
        </tr>
        <tr>
          <td>Overlay configuration</td>
          <td>Controls modes, integrations, maturity guardrails, pricing tiers, module toggles</td>
          <td><code>config/fixops.overlay.yml</code></td>
        </tr>
        <tr>
          <td>CLI &amp; automation</td>
          <td>Use <code>curl</code>, scripts, or CI jobs to push artefacts to <code>/inputs/*</code></td>
          <td><code>docs/PLATFORM_RUNBOOK.md</code></td>
        </tr>
        <tr>
          <td>Evidence &amp; manifests</td>
          <td>Persist guardrail, policy, SSDLC, AI, exploit, and probabilistic outputs for audits</td>
          <td><code>fixops/evidence.py</code></td>
        </tr>
        <tr>
          <td>Simulations &amp; tests</td>
          <td>Prove contextual severity shifts and regression coverage</td>
          <td><code>simulations/cve_scenario/runner.py</code></td>
        </tr>
      </tbody>
    </table>
  </section>

  <section id="start">
    <h2>Five-Minute Quick Start</h2>
    <div class="timeline">
      <div class="timeline-step">
        <strong>1. Install &amp; configure</strong>
        <p>Install dependencies via <code>pip install -r requirements.txt</code>. Export <code>FIXOPS_API_TOKEN</code> to match the overlay profile you will run.</p>
      </div>
      <div class="timeline-step">
        <strong>2. Launch the API</strong>
        <pre><code>uvicorn backend.app:create_app --factory --reload</code></pre>
        <p>The application loads <code>config/fixops.overlay.yml</code>, provisions allowlisted directories, and enforces API-key auth.</p>
      </div>
      <div class="timeline-step">
        <strong>3. Upload artefacts</strong>
        <pre><code>curl -H "X-API-Key: ${FIXOPS_API_TOKEN}" -F "file=@samples/design.csv;type=text/csv" http://127.0.0.1:8000/inputs/design
curl -H "X-API-Key: ${FIXOPS_API_TOKEN}" -F "file=@samples/sbom.json;type=application/json" http://127.0.0.1:8000/inputs/sbom
curl -H "X-API-Key: ${FIXOPS_API_TOKEN}" -F "file=@samples/scan.sarif;type=application/json" http://127.0.0.1:8000/inputs/sarif
curl -H "X-API-Key: ${FIXOPS_API_TOKEN}" -F "file=@samples/kev.json;type=application/json" http://127.0.0.1:8000/inputs/cve</code></pre>
      </div>
      <div class="timeline-step">
        <strong>4. Run the pipeline</strong>
        <pre><code>curl -H "X-API-Key: ${FIXOPS_API_TOKEN}" -X POST http://127.0.0.1:8000/pipeline/run | jq</code></pre>
        <p>Review guardrail status, contextual scoring, policy automation results, pricing plan, and evidence bundle pointer.</p>
      </div>
      <div class="timeline-step">
        <strong>5. Explore evidence</strong>
        <p>Navigate to the overlay-specified <code>evidence_dir</code> to review manifests, SSDLC assessments, policy dispatch logs, and contextual summaries.</p>
      </div>
    </div>
  </section>

  <section id="overlay">
    <h2>Overlay Configuration: From Simple to Advanced</h2>
    <p>The overlay file is the single source of truth for feature toggles, integrations, compliance packs, pricing, and custom modules.</p>
    <table>
      <thead>
        <tr>
          <th>Layer</th>
          <th>Demo Profile</th>
          <th>Enterprise Profile</th>
          <th>Key Keys</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Core</td>
          <td>Mode = <code>demo</code>, default evidence directory, sample onboarding steps</td>
          <td>Mode = <code>enterprise</code>, mandatory Jira/Confluence/Git/CI, hardened evidence paths</td>
          <td><code>mode</code>, <code>directories</code>, <code>onboarding</code></td>
        </tr>
        <tr>
          <td>Context engine</td>
          <td>Lightweight criticality/data weights, example business context</td>
          <td>Regulated data weights, production exposure boosts, custom tags</td>
          <td><code>context_engine.weights</code></td>
        </tr>
        <tr>
          <td>Automation</td>
          <td>Guardrails = warn only, policy planner disabled</td>
          <td>Fail thresholds, Jira ticket sync, Confluence page pushes</td>
          <td><code>guardrails</code>, <code>policy.actions</code></td>
        </tr>
        <tr>
          <td>AI &amp; analytics</td>
          <td>Sample AI framework detection, baseline probabilistic module off</td>
          <td>Full AI watchlist, exploitability, Bayesian/Markov forecasts enabled</td>
          <td><code>ai_agents</code>, <code>exploit_signals</code>, <code>probabilistic</code></td>
        </tr>
        <tr>
          <td>Custom modules</td>
          <td>Disabled by default</td>
          <td>Enable terraform-like hooks, IaC posture checks, SSDLC gates</td>
          <td><code>modules</code></td>
        </tr>
        <tr>
          <td>Pricing</td>
          <td>Usage caps + upgrade prompts</td>
          <td>Committed volume, SLA statements, entitlement metadata</td>
          <td><code>pricing</code></td>
        </tr>
      </tbody>
    </table>
    <p>Override any value using environment variables with the <code>FIXOPS_OVERLAY_*</code> prefix or by pointing <code>FIXOPS_OVERLAY_PATH</code> at a custom YAML file.</p>
  </section>

  <section id="api">
    <h2>API Reference Cheat Sheet</h2>
    <table>
      <thead>
        <tr>
          <th>Endpoint</th>
          <th>Verb</th>
          <th>Description</th>
          <th>Key Headers</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>/inputs/design</code></td>
          <td>POST</td>
          <td>Upload CSV with component metadata (<code>component</code>, <code>service</code>, <code>owner</code>, optional <code>name</code>)</td>
          <td><code>X-API-Key</code>, <code>Content-Type</code> with MIME validation</td>
        </tr>
        <tr>
          <td><code>/inputs/sbom</code></td>
          <td>POST</td>
          <td>Upload SBOM JSON. Automatically normalised + cached.</td>
          <td><code>X-API-Key</code></td>
        </tr>
        <tr>
          <td><code>/inputs/sarif</code></td>
          <td>POST</td>
          <td>Upload scanner results for guardrail severity aggregation.</td>
          <td><code>X-API-Key</code></td>
        </tr>
        <tr>
          <td><code>/inputs/cve</code></td>
          <td>POST</td>
          <td>Upload KEV/EPSS feeds for exploitability analysis.</td>
          <td><code>X-API-Key</code></td>
        </tr>
        <tr>
          <td><code>/pipeline/run</code></td>
          <td>POST</td>
          <td>Execute the orchestrator, returning guardrails, context, compliance, AI, exploit, SSDLC, IaC, probabilistic forecasts, pricing, evidence pointers.</td>
          <td><code>X-API-Key</code></td>
        </tr>
        <tr>
          <td><code>/overlay/export</code></td>
          <td>GET</td>
          <td>Retrieve a sanitised view of the active overlay (redacts secrets, restricts directories).</td>
          <td><code>X-API-Key</code></td>
        </tr>
        <tr>
          <td><code>/feedback</code></td>
          <td>POST</td>
          <td>Submit structured user feedback gated by overlay flag. Persists in allowlisted dir.</td>
          <td><code>X-API-Key</code></td>
        </tr>
      </tbody>
    </table>
  </section>

  <section id="deep">
    <h2>Detailed Data Flow</h2>
    <ol>
      <li><strong>Input stage</strong> – API handlers stream uploads to disk only when MIME and directory checks pass. The normalisers (<code>backend/normalizers.py</code>) cache artefact hashes to prevent redundant parsing.</li>
      <li><strong>Crosswalk assembly</strong> – <code>backend/pipeline.py</code> merges design rows, SBOM entries, SARIF findings, and CVE feeds into a keyed structure, keeping per-row indices for traceability.</li>
      <li><strong>Module execution</strong> – The orchestrator consults <code>OverlayConfig.enabled_modules</code> to run context scoring, guardrails, compliance, policy automation, SSDLC, IaC posture, AI agent detection, exploitability, and probabilistic forecasts.</li>
      <li><strong>Evidence + pricing</strong> – <code>fixops/evidence.py</code> writes bundles (JSON + manifests) to allowlisted directories, attaching module matrices, policy dispatch manifests, SSDLC coverage, and pricing entitlements.</li>
      <li><strong>Response</strong> – The API response includes all module outputs, severity aggregations, exploitability notes, Bayesian confidence metrics, AI and SSDLC advisories, and the evidence bundle reference.</li>
      <li><strong>Feedback loop</strong> – Optional overlay flag exposes <code>/feedback</code> for secure operator submissions tied to the run identifier.</li>
    </ol>
    <div class="callout">
      <strong>Tip:</strong> Toggle modules without redeploying by editing the overlay file and reloading the server. The loader validates schemas, normalises paths, and reveals errors at startup.
    </div>
  </section>

  <section id="build">
    <h2>Building Extensions</h2>
    <ul>
      <li>Register custom modules under <code>overlay.modules.custom</code> with import paths. They receive a <code>PipelineContext</code> object and may return structured dictionaries that get merged into the API response.</li>
      <li>Ship Terraform-style bundles by versioning overlay fragments per environment (dev, staging, prod) and composing them before deployment.</li>
      <li>Use the sanitised overlay export to share configuration defaults with customers without leaking secrets.</li>
      <li>Integrate with CI/CD by running <code>scripts/generate_index.py</code> to refresh repository maps and <code>pytest</code> to verify regression coverage before publishing new overlays.</li>
    </ul>
  </section>

  <section id="testing">
    <h2>Testing Every Feature</h2>
    <pre><code>pytest
python -m simulations.cve_scenario.runner --mode demo
python -m simulations.cve_scenario.runner --mode enterprise
python -m compileall backend fixops simulations tests
</code></pre>
    <p>These commands validate unit coverage, contextual CVE scoring, enterprise guardrails, and bytecode sanity. Extend with custom scenarios by adding fixtures under <code>tests/</code>.</p>
  </section>

  <section id="troubleshooting">
    <h2>Troubleshooting Checklist</h2>
    <ul>
      <li>Pipeline rejects uploads? Verify MIME type matches overlay allowlist and your API key is enabled for the current mode.</li>
      <li>No evidence bundle? Ensure <code>overlay.directories.evidence_dir</code> exists and the service has write permissions.</li>
      <li>Missing automation results? Check <code>overlay.policy.actions</code> and <code>overlay.guardrails</code> thresholds; ensure required connectors are configured.</li>
      <li>Unexpected module output? Inspect <code>pipeline_result["modules"]</code> in the API response to confirm which modules were executed.</li>
      <li>Performance concerns? Review <code>perf/BENCHMARKS.csv</code> and enable/disable probabilistic or custom modules as needed.</li>
    </ul>
  </section>

  <section id="summary">
    <h2>Feature Summary</h2>
    <table>
      <thead>
        <tr>
          <th>Feature</th>
          <th>Value</th>
          <th>How to Use</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Context engine</td>
          <td>Business-aware severity re-weighting</td>
          <td>Enabled by default; adjust <code>context_engine.weights</code></td>
        </tr>
        <tr>
          <td>Evidence hub</td>
          <td>Audit-ready bundles + manifests</td>
          <td>Review overlay evidence directory after pipeline runs</td>
        </tr>
        <tr>
          <td>Policy automation</td>
          <td>Dispatch manifests &amp; guardrail enforcement</td>
          <td>Configure <code>policy.actions</code>; monitor pipeline response summaries</td>
        </tr>
        <tr>
          <td>Compliance packs</td>
          <td>Framework alignment dashboards</td>
          <td>Toggle frameworks under <code>compliance.packs</code></td>
        </tr>
        <tr>
          <td>AI agent &amp; exploit intelligence</td>
          <td>Framework detection and exploitability scoring</td>
          <td>Enable under <code>ai_agents</code> and <code>exploit_signals</code></td>
        </tr>
        <tr>
          <td>Probabilistic forecasting</td>
          <td>Bayesian + Markov progression metrics</td>
          <td>Configure <code>probabilistic</code> priors and transitions</td>
        </tr>
        <tr>
          <td>SSDLCEvaluator</td>
          <td>Lifecycle control coverage</td>
          <td>Adjust per-stage expectations under <code>ssdlc</code></td>
        </tr>
        <tr>
          <td>IaC posture</td>
          <td>Multi-cloud / on-prem control checks</td>
          <td>Supply IaC artefacts and configure <code>iac.targets</code></td>
        </tr>
      </tbody>
    </table>
  </section>

  <footer>
    Need more depth? Explore <code>docs/PLATFORM_RUNBOOK.md</code>, <code>docs/CONFIG_GUIDE.md</code>, and <code>docs/ARCHITECTURE.md</code> for architectural context, or run the CVE simulation to showcase FixOps to stakeholders.
  </footer>
</body>
</html>
