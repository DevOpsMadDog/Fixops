"""Malware Detection Router â€” Malware scanning endpoints."""

from __future__ import annotations

from typing import Any, Dict

from fastapi import APIRouter
from pydantic import BaseModel

router = APIRouter(prefix="/api/v1/malware", tags=["Malware Detection"])


class ScanContentRequest(BaseModel):
    content: str
    filename: str = "unknown"


class ScanFilesRequest(BaseModel):
    files: Dict[str, str]  # {filename: content}


@router.post("/scan/content")
async def scan_content(req: ScanContentRequest) -> Dict[str, Any]:
    """Scan file content for malware indicators."""
    from core.malware_detector import get_malware_detector

    detector = get_malware_detector()
    result = detector.scan_content(req.content, req.filename)
    return result.to_dict()


@router.post("/scan/files")
async def scan_files(req: ScanFilesRequest) -> Dict[str, Any]:
    """Scan multiple files for malware."""
    from core.malware_detector import get_malware_detector

    detector = get_malware_detector()
    result = detector.scan_files(req.files)
    return result.to_dict()


@router.get("/signatures")
async def list_signatures() -> Dict[str, Any]:
    """List all malware signatures."""
    from core.malware_detector import MALWARE_SIGNATURES

    return {
        "signatures": [
            {"id": s[0], "title": s[2], "severity": s[3], "category": s[4]}
            for s in MALWARE_SIGNATURES
        ],
        "total": len(MALWARE_SIGNATURES),
    }


@router.get("/status")
async def malware_status() -> Dict[str, Any]:
    return {"engine": "malware_detector", "status": "ready", "version": "1.0.0"}

