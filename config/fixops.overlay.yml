mode: enterprise

# Analysis engines configuration with OSS fallback
analysis_engines:
  # Strategy: proprietary_first, oss_first, proprietary_only, oss_only
  strategy: proprietary_first
  
  # Result combination: merge, replace, best_of
  result_combination: merge
  
  # Language support with OSS fallback
  languages:
    python:
      proprietary: enabled
      oss_fallback:
        enabled: true
        tools: [semgrep, bandit]
        priority: 1
    javascript:
      proprietary: enabled
      oss_fallback:
        enabled: true
        tools: [semgrep, eslint]
        priority: 1
    typescript:
      proprietary: enabled
      oss_fallback:
        enabled: true
        tools: [semgrep, eslint]
        priority: 1
    java:
      proprietary: enabled
      oss_fallback:
        enabled: true
        tools: [codeql, semgrep]
        priority: 1
    cpp:
      proprietary: enabled
      oss_fallback:
        enabled: true
        tools: [codeql, semgrep, cppcheck]
        priority: 1
    rust:
      proprietary: enabled
      oss_fallback:
        enabled: true
        tools: [semgrep, clippy]
        priority: 1
    go:
      proprietary: enabled
      oss_fallback:
        enabled: true
        tools: [semgrep, gosec]
        priority: 1
    ruby:
      proprietary: enabled
      oss_fallback:
        enabled: true
        tools: [semgrep, brakeman]
        priority: 1
    php:
      proprietary: enabled
      oss_fallback:
        enabled: true
        tools: [semgrep, phpstan]
        priority: 1
    dotnet:
      proprietary: enabled
      oss_fallback:
        enabled: true
        tools: [semgrep, sonarqube]
        priority: 1
  
  # IaC analysis with OSS fallback
  iac:
    terraform:
      proprietary: enabled
      oss_fallback:
        enabled: true
        tools: [checkov, terrascan, tflint]
        priority: 1
    cloudformation:
      proprietary: enabled
      oss_fallback:
        enabled: true
        tools: [checkov, cfn-lint]
        priority: 1
    kubernetes:
      proprietary: enabled
      oss_fallback:
        enabled: true
        tools: [kube-score, polaris, kubeaudit]
        priority: 1
    dockerfile:
      proprietary: enabled
      oss_fallback:
        enabled: true
        tools: [hadolint, docker-bench]
        priority: 1
  
  # Container security with OSS fallback
  container:
    image_scanning:
      proprietary: enabled
      oss_fallback:
        enabled: true
        tools: [trivy, clair, grype]
        priority: 1
    runtime_security:
      proprietary: enabled
      oss_fallback:
        enabled: false  # No OSS fallback for runtime
  
  # Cloud security with OSS fallback
  cloud:
    cspm:
      proprietary: enabled
      oss_fallback:
        enabled: true
        tools:
          aws: [prowler, scout-suite, cloudsploit]
          azure: [prowler, azsk]
          gcp: [prowler, forseti]
        priority: 1
    runtime_security:
      proprietary: enabled
      oss_fallback:
        enabled: false  # No OSS fallback for runtime
  
  # API security with OSS fallback
  api:
    security_testing:
      proprietary: enabled
      oss_fallback:
        enabled: true
        tools: [owasp-zap, burp-suite]
        priority: 1
  
  # Remediation with OSS fallback
  remediation:
    code_fixes:
      proprietary: enabled
      oss_fallback:
        enabled: true
        tools: [github-copilot, codex]
        priority: 1
    dependency_updates:
      proprietary: enabled
      oss_fallback:
        enabled: true
        tools: [dependabot, renovate]
        priority: 1

# OSS tools configuration (see config/oss_tools.yml for details)
oss_tools_config_path: config/oss_tools.yml

# Fallback behavior
fallback:
  triggers:
    - proprietary_failed
    - proprietary_timeout
    - proprietary_error
    - overlay_override
  result_priority:
    proprietary: 1
    oss: 2

jira:
  url: https://jira.example.com
  project_key: SEC
  default_issue_type: Task
  user_email: bot@fixops.local
  token_env: FIXOPS_JIRA_TOKEN
confluence:
  base_url: https://confluence.example.com
  space_key: SECOPS
  user: fixops-bot
  token_env: FIXOPS_CONFLUENCE_TOKEN
auth:
  strategy: token
  token_env: FIXOPS_API_TOKEN
  header: X-API-Key
data:
  design_context_dir: data/design_context
  evidence_dir: data/evidence
  archive_dir: data/archive
  analytics_dir: data/analytics
  automation_dir: data/automation
  feedback_dir: data/feedback
limits:
  max_upload_bytes:
    default: 3145728
    sarif: 6291456
    cve: 6291456
  evidence:
    bundle_max_bytes: 1048576
    compress: true
    encrypt: true
    encryption_env: FIXOPS_EVIDENCE_KEY
modules:
  guardrails: { enabled: true }
  context_engine: { enabled: true }
  onboarding: { enabled: true }
  compliance: { enabled: true }
  policy_automation: { enabled: true }
  evidence: { enabled: true }
  ai_agents: { enabled: true }
  ssdlc: { enabled: true }
  exploit_signals: { enabled: true }
  probabilistic: { enabled: true }
  pricing: { enabled: true }
  iac_posture: { enabled: true }
  analytics: { enabled: true }
  tenancy: { enabled: true }
  performance: { enabled: true }
  vector_store:
    enabled: true
    provider: auto
    patterns_path: fixtures/security_patterns.json
    top_k: 3
  enhanced_decision: { enabled: true }
  correlation_engine:
    enabled: true
    strategies:
      - fingerprint
      - location
      - pattern
      - root_cause
      - vulnerability
    noise_reduction_target: 0.35
    dedup_window_hours: 24
    preserve_raw: true
    cross_stage:
      enabled: true
      link_attributes:
        - cve_id
        - component
        - asset_id
        - repo_path
        - rule_id

# Integration adapters configuration
integrations:
  gitlab:
    enabled: true
    url_env: FIXOPS_GITLAB_URL
    token_env: FIXOPS_GITLAB_TOKEN
    webhook_secret_env: FIXOPS_GITLAB_WEBHOOK_SECRET
  azure_devops:
    enabled: true
    organization_env: FIXOPS_AZDO_ORG
    project_env: FIXOPS_AZDO_PROJECT
    token_env: FIXOPS_AZDO_TOKEN
  snyk:
    enabled: true
    org_id_env: FIXOPS_SNYK_ORG_ID
    token_env: FIXOPS_SNYK_TOKEN
    sync_mode: pull
  defectdojo:
    enabled: true
    url_env: FIXOPS_DEFECTDOJO_URL
    token_env: FIXOPS_DEFECTDOJO_TOKEN
    product_id_env: FIXOPS_DEFECTDOJO_PRODUCT_ID
  datadog:
    enabled: false
    site: datadoghq.com
    api_key_env: FIXOPS_DD_API_KEY
    app_key_env: FIXOPS_DD_APP_KEY
  pagerduty:
    enabled: false
    routing_key_env: FIXOPS_PD_ROUTING_KEY
    severity_mapping:
      critical: critical
      high: error
      medium: warning
      low: info
  mitre_mapping:
    enabled: false
    techniques:
      - T1190  # Exploit Public-Facing Application
      - T1133  # External Remote Services
      - T1566  # Phishing
      - T1189  # Drive-by Compromise
      - T1059  # Command and Scripting Interpreter
      - T1203  # Exploitation for Client Execution
      - T1204  # User Execution
      - T1053  # Scheduled Task/Job
      - T1078  # Valid Accounts
      - T1098  # Account Manipulation
      - T1505  # Server Software Component
      - T1068  # Exploitation for Privilege Escalation
      - T1055  # Process Injection
      - T1548  # Abuse Elevation Control Mechanism
      - T1027  # Obfuscated Files or Information
      - T1070  # Indicator Removal
      - T1562  # Impair Defenses
      - T1003  # OS Credential Dumping
      - T1110  # Brute Force
      - T1555  # Credentials from Password Stores
      - T1056  # Input Capture
      - T1083  # File and Directory Discovery
      - T1087  # Account Discovery
      - T1046  # Network Service Discovery
      - T1021  # Remote Services
      - T1210  # Exploitation of Remote Services
      - T1005  # Data from Local System
      - T1213  # Data from Information Repositories
      - T1071  # Application Layer Protocol
      - T1573  # Encrypted Channel
      - T1041  # Exfiltration Over C2 Channel
      - T1567  # Exfiltration Over Web Service
      - T1486  # Data Encrypted for Impact
      - T1498  # Network Denial of Service
      - T1565  # Data Manipulation
  compliance_analysis:
    enabled: false
    frameworks:
      - pci_dss
      - sox
      - hipaa
      - nist_ssdf
policy_automation:
  actions:
    - id: jira-guardrail-fail
      trigger: guardrail:fail
      type: jira_issue
      summary: Guardrail failure detected
      description: FixOps detected a guardrail failure and created this ticket automatically.
      priority: High
    - id: confluence-guardrail-warn
      trigger: guardrail:warn
      type: confluence_page
      title: FixOps guardrail warning summary
      representation: storage
compliance:
  frameworks:
    - name: SOC2
      controls:
        - id: CC8.1
          title: Change Management Evidence
          requires: [design, guardrails, evidence]
        - id: CC7.2
          title: Continuous Vulnerability Management
          requires: [sarif, cve, context]
        - id: CC6.1
          title: Logical and Physical Access Controls
          requires: [design, context]
        - id: CC6.6
          title: Vulnerabilities Are Identified and Addressed
          requires: [sarif, cve, guardrails]
    - name: ISO27001
      controls:
        - id: A.12.6.1
          title: Application vulnerability management
          requires: [sbom, cve]
        - id: A.14.2.8
          title: System security testing
          requires: [sarif, guardrails]
    - name: PCI_DSS
      controls:
        - id: "6.2"
          title: Ensure all system components are protected from known vulnerabilities
          requires: [sbom, cve, guardrails]
        - id: "6.5.1"
          title: Injection flaws, particularly SQL injection
          requires: [sarif, guardrails]
        - id: "6.5.3"
          title: Insecure cryptographic storage
          requires: [sarif, design]
        - id: "6.5.8"
          title: Improper access control
          requires: [sarif, design, context]
        - id: "11.2"
          title: Run internal and external network vulnerability scans quarterly
          requires: [sarif, cve]
        - id: "11.3"
          title: Implement penetration testing methodology
          requires: [sarif, guardrails, evidence]
    - name: GDPR
      controls:
        - id: Article_32
          title: Security of Processing
          requires: [design, evidence, guardrails]
        - id: Article_25
          title: Data Protection by Design and Default
          requires: [design, context]
  profiles:
    enterprise:
      frameworks:
        - name: ISO27001
          controls:
            - id: A.12.6.1
              title: Application vulnerability management
              requires: [sbom, cve]
        - name: PCI_DSS
          controls:
            - id: "6.2"
              title: Ensure all system components are protected from known vulnerabilities
              requires: [sbom, cve, guardrails]
            - id: "11.2"
              title: Run vulnerability scans quarterly
              requires: [sarif, cve]
context_engine:
  fields:
    criticality: customer_impact
    data: data_classification
    exposure: exposure
  criticality_weights:
    mission_critical: 4
    external: 3
    internal: 1
  data_weights:
    pii: 4
    financial: 4
    health: 4
    internal: 2
    public: 1
  exposure_weights:
    internet: 3
    partner: 2
    internal: 1
  playbooks:
    - name: Stabilise Customer Impact
      min_score: 9
      channel: sre-pager
    - name: Sprint Triage
      min_score: 6
      channel: appsec-kanban
    - name: Monitor
      min_score: 0
      channel: platform-notifications
guardrails:
  maturity: scaling
  profiles:
    foundational: { fail_on: critical, warn_on: high }
    scaling: { fail_on: high, warn_on: medium }
    advanced: { fail_on: medium, warn_on: medium }
pricing:
  plans:
    - id: enterprise
      name: Enterprise
      evidence_encryption: true
      modes: [enterprise]
onboarding:
  time_to_value_minutes: 25
  checklist:
    - step: Upload design context CSV
      modes: [demo, enterprise]
    - step: Upload SBOM JSON
      modes: [demo, enterprise]
    - step: Upload SARIF scan
      modes: [demo, enterprise]
    - step: Upload CVE/KEV feed
      modes: [demo, enterprise]
    - step: Review context summary and guardrails
      modes: [demo, enterprise]
  profiles:
    enterprise:
      time_to_value_minutes: 20
      checklist:
        - step: Connect Jira project
          modes: [enterprise]
        - step: Sync Confluence evidence space
          modes: [enterprise]
        - step: Approve policy automation routes
          modes: [enterprise]
probabilistic:
  enabled: true
  # Switchable risk models configuration
  risk_models:
    enabled: true
    default_model: bn_lr_hybrid_v1  # Primary model to use
    fallback_chain:  # Try models in order if primary fails
      - bn_lr_hybrid_v1
      - bayesian_network_v1
      - weighted_scoring_v1
    models:
      weighted_scoring_v1:
        enabled: true
        priority: 10
        config:
          severity_weights:
            critical: 1.0
            high: 0.75
            medium: 0.5
            low: 0.25
          allow_threshold: 0.6
          block_threshold: 0.85
      bayesian_network_v1:
        enabled: true
        priority: 50
        config:
          allow_threshold: 0.6
          block_threshold: 0.85
      bn_lr_hybrid_v1:
        enabled: true
        priority: 100
        config:
          allow_threshold: 0.6
          block_threshold: 0.85
    # A/B testing configuration (optional)
    ab_test:
      enabled: false
      control_model: bayesian_network_v1
      treatment_model: bn_lr_hybrid_v1
      traffic_split: 0.5  # 50% to treatment
      hash_key: cve_id  # Use CVE ID for consistent assignment
exploit_signals:
  enabled: true
  signals:
    kev:
      label: "CISA KEV Listed"
      mode: "boolean"
      fields:
        - "knownExploited"
        - "knownRansomwareCampaignUse"
        - "kev.knownExploited"
      escalate_to: "critical"
      rationale: "CVE is listed in CISA Known Exploited Vulnerabilities catalog"
    epss_high:
      label: "EPSS High Probability"
      mode: "probability"
      fields:
        - "epss"
        - "epss_score"
        - "metrics.epss"
      threshold: 0.60
      severity_floor: "high"
      rationale: "EPSS score >= 60% indicates high exploitation probability"
    epss_critical:
      label: "EPSS Critical Probability"
      mode: "probability"
      fields:
        - "epss"
        - "epss_score"
        - "metrics.epss"
      threshold: 0.85
      escalate_to: "critical"
      rationale: "EPSS score >= 85% indicates critical exploitation probability"
ssdlc:
  enabled: true
iac:
  enabled: true
analytics:
  enabled: true
tenancy:
  enabled: true
performance:
  enabled: true
enhanced_decision:
  baseline_confidence: 0.82
  providers:
    - name: gpt-5
      style: strategist
      focus: [mitre, context]
    - name: claude-3
      style: analyst
      focus: [compliance, guardrails]
    - name: gemini-2
      style: signals
      focus: [exploit, cnapp]
    - name: sentinel-cyber
      style: threat
      focus: [marketplace, agents]
  knowledge_graph:
    nodes:
      - { id: service, type: asset }
      - { id: finding, type: vulnerability }
      - { id: control, type: compliance }
      - { id: mitigation, type: playbook }
    edges:
      - { source: service, target: finding, type: impacted_by }
      - { source: finding, target: control, type: mitigated_by }
      - { source: finding, target: mitigation, type: remediated_by }
  hallucination_guards:
    enabled: true
    disagreement_threshold: 0.3
    numeric_tolerance: 0.05
    confidence_penalty: 0.15
decision_tree:
  enabled: true
  thresholds:
    not_exploitable_max: 0.15
    exploitable_min: 0.70
    require_attack_path: true
    min_confidence: 0.60
  probabilistic:
    prior_exploit: 0.05
    markov:
      lambda_ux_to_ex: 0.01
      lambda_ux_to_mit: 0.03
      lambda_ex_to_mit: 0.05
      kev_boost_factor: 5.0
      patch_boost_factor: 3.33
  required_frameworks:
    - NIST 800-53
    - PCI DSS
telemetry_bridge:
  mode: http
  fixops_url: https://fixops.example/api/v1/telemetry
  api_key_secret_ref: fixops-api-key
  ring_buffer:
    max_lines: 200000
    max_seconds: 21600
  retention_days:
    raw: 7
    summary: 30
    evidence: 365
  fluentbit:
    input_path: /var/log/waf/*.log
    aggregation_interval: 60
    retry_limit: 5
  vector:
    input_path: /logs/app.log
    flush_interval: 30
  aws:
    region: ap-southeast-2
    s3_bucket: fixops-evidence
    cw_log_groups: []
  azure:
    location: australiaeast
    storage_account: fixopsevidence
    event_hub: platform-logs
    key_vault_name: fixops-kv
  gcp:
    project_id: my-fixops
    gcs_bucket: fixops-evidence
