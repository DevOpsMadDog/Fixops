# FixOps Normalizer Registry Configuration
# This file defines the plugin registry for custom format handling
# Each normalizer can be enabled/disabled and configured independently

version: "1.0"

# Global settings for the normalizer registry
settings:
  # Maximum document size in bytes (default: 100MB)
  max_document_bytes: 104857600
  # Maximum number of findings per batch (default: 50000)
  max_findings_per_batch: 50000
  # Enable parallel processing for large documents
  parallel_processing: true
  # Number of worker threads for parallel processing
  worker_threads: 4
  # Enable lenient parsing for format drift handling
  lenient_parsing: true
  # Schema evolution mode: strict, lenient, or auto
  schema_evolution_mode: auto
  # Cache parsed schemas for performance
  cache_schemas: true
  # Cache TTL in seconds (default: 1 hour)
  cache_ttl_seconds: 3600

# Format detection settings
format_detection:
  # Auto-detect format based on content
  auto_detect: true
  # Fallback format if detection fails
  fallback_format: sarif
  # Detection confidence threshold (0.0-1.0)
  confidence_threshold: 0.7
  # File extension mappings
  extension_mappings:
    ".sarif": sarif
    ".sarif.json": sarif
    ".json": auto
    ".xml": auto
    ".cdx.json": cyclonedx
    ".spdx.json": spdx
    ".vex.json": vex
    ".yaml": auto
    ".yml": auto

# Normalizer plugins
normalizers:
  # SARIF 2.1+ normalizer
  sarif:
    enabled: true
    priority: 100
    description: "SARIF 2.1.0 static analysis results"
    supported_versions:
      - "2.1.0"
      - "2.1.0-rtm.5"
    schemas:
      - "https://json.schemastore.org/sarif-2.1.0.json"
      - "http://json.schemastore.org/sarif-2.1.0.json"
      - "https://schemastore.azurewebsites.net/schemas/json/sarif-2.1.0-rtm.5.json"
    lenient_fields:
      - "properties"
      - "partialFingerprints"
      - "fingerprints"
    detection_patterns:
      - '"\$schema".*sarif'
      - '"version".*"2\.1\.'
      - '"runs".*\['

  # CycloneDX SBOM normalizer
  cyclonedx:
    enabled: true
    priority: 90
    description: "CycloneDX Software Bill of Materials"
    supported_versions:
      - "1.4"
      - "1.5"
      - "1.6"
    schemas:
      - "http://cyclonedx.org/schema/bom-1.4.schema.json"
      - "http://cyclonedx.org/schema/bom-1.5.schema.json"
      - "http://cyclonedx.org/schema/bom-1.6.schema.json"
    lenient_fields:
      - "properties"
      - "externalReferences"
      - "evidence"
    detection_patterns:
      - '"bomFormat".*"CycloneDX"'
      - '"specVersion".*"1\.[456]"'
      - 'xmlns.*cyclonedx'

  # SPDX SBOM normalizer
  spdx:
    enabled: true
    priority: 85
    description: "SPDX Software Package Data Exchange"
    supported_versions:
      - "2.2"
      - "2.3"
      - "3.0"
    schemas:
      - "https://spdx.org/rdf/spdx-terms-v2.2"
      - "https://spdx.org/rdf/spdx-terms-v2.3"
    lenient_fields:
      - "annotations"
      - "relationships"
      - "externalDocumentRefs"
    detection_patterns:
      - '"spdxVersion"'
      - '"SPDXID"'
      - 'SPDXRef-DOCUMENT'

  # VEX (Vulnerability Exploitability eXchange) normalizer
  vex:
    enabled: true
    priority: 80
    description: "Vulnerability Exploitability eXchange"
    supported_versions:
      - "1.0"
      - "2.0"
    formats:
      - cyclonedx_vex
      - csaf_vex
      - openvex
    lenient_fields:
      - "justification"
      - "impact_statement"
      - "action_statement"
    detection_patterns:
      - '"vulnerabilities".*"analysis"'
      - '"@type".*"VexDocument"'
      - '"openvex"'

  # CNAPP (Cloud-Native Application Protection Platform) normalizer
  cnapp:
    enabled: true
    priority: 75
    description: "Cloud-Native Application Protection Platform findings"
    supported_providers:
      - wiz
      - prisma_cloud
      - aqua
      - lacework
      - orca
      - snyk_cloud
    lenient_fields:
      - "metadata"
      - "tags"
      - "custom_attributes"
    detection_patterns:
      - '"cloudProvider"'
      - '"resourceType"'
      - '"securityFindings"'
      - '"cloudAssets"'

  # Dark Web Intelligence normalizer
  dark_web_intel:
    enabled: true
    priority: 70
    description: "Dark web threat intelligence feeds"
    supported_sources:
      - recorded_future
      - flashpoint
      - digital_shadows
      - intel471
      - mandiant
      - crowdstrike
      - zerofox
    data_types:
      - credential_leak
      - data_breach
      - threat_actor
      - malware
      - vulnerability_exploit
      - brand_mention
      - executive_threat
    lenient_fields:
      - "raw_content"
      - "source_metadata"
      - "confidence_indicators"
    detection_patterns:
      - '"darkWebSource"'
      - '"threatIntelligence"'
      - '"credentialLeak"'
      - '"dataBreachIndicator"'

  # CVE/NVD feed normalizer
  cve_feed:
    enabled: true
    priority: 65
    description: "CVE and NVD vulnerability feeds"
    supported_formats:
      - nvd_json
      - cve_json_5
      - kev_json
      - epss_csv
    lenient_fields:
      - "configurations"
      - "references"
      - "metrics"
    detection_patterns:
      - '"CVE-[0-9]{4}-[0-9]+'
      - '"cveMetadata"'
      - '"vulnerabilities".*"cve"'

  # Snyk JSON normalizer
  snyk:
    enabled: true
    priority: 60
    description: "Snyk vulnerability scanner output"
    supported_types:
      - open_source
      - code
      - container
      - iac
    lenient_fields:
      - "remediation"
      - "exploit"
      - "semver"
    detection_patterns:
      - '"vulnerabilities".*"snyk"'
      - '"projectName".*"snyk"'
      - '"packageManager"'

  # Trivy JSON normalizer
  trivy:
    enabled: true
    priority: 55
    description: "Trivy vulnerability scanner output"
    supported_types:
      - os
      - library
      - config
      - secret
      - license
    lenient_fields:
      - "layer"
      - "dataSource"
    detection_patterns:
      - '"SchemaVersion".*[12]'
      - '"ArtifactType"'
      - '"Results".*"Vulnerabilities"'

  # Grype JSON normalizer
  grype:
    enabled: true
    priority: 50
    description: "Grype vulnerability scanner output"
    lenient_fields:
      - "matchDetails"
      - "artifact"
    detection_patterns:
      - '"matches".*"vulnerability"'
      - '"descriptor".*"grype"'

  # Semgrep SARIF/JSON normalizer
  semgrep:
    enabled: true
    priority: 45
    description: "Semgrep static analysis output"
    lenient_fields:
      - "extra"
      - "metadata"
    detection_patterns:
      - '"semgrep"'
      - '"check_id".*"semgrep"'

  # GitHub Dependabot normalizer
  dependabot:
    enabled: true
    priority: 40
    description: "GitHub Dependabot alerts"
    lenient_fields:
      - "dismissed_reason"
      - "fixed_in"
    detection_patterns:
      - '"dependency".*"package"'
      - '"security_advisory"'
      - '"ghsa_id"'

  # AWS Security Hub normalizer
  aws_security_hub:
    enabled: true
    priority: 35
    description: "AWS Security Hub findings"
    lenient_fields:
      - "ProductFields"
      - "Resources"
      - "Compliance"
    detection_patterns:
      - '"AwsAccountId"'
      - '"GeneratorId"'
      - '"ProductArn".*"securityhub"'

  # Azure Defender normalizer
  azure_defender:
    enabled: true
    priority: 30
    description: "Microsoft Defender for Cloud findings"
    lenient_fields:
      - "extendedProperties"
      - "entities"
    detection_patterns:
      - '"alertType"'
      - '"azureResourceId"'
      - '"Microsoft.Security"'

  # GCP Security Command Center normalizer
  gcp_scc:
    enabled: true
    priority: 25
    description: "Google Cloud Security Command Center findings"
    lenient_fields:
      - "sourceProperties"
      - "securityMarks"
    detection_patterns:
      - '"findingClass"'
      - '"securityCenterProperties"'
      - '"projects/.*/sources/'

# Asset inventory settings
asset_inventory:
  enabled: true
  # Continuous discovery interval in seconds
  discovery_interval: 300
  # Asset types to track
  asset_types:
    - compute
    - storage
    - network
    - database
    - identity
    - container
    - serverless
    - kubernetes
  # Cloud providers for discovery
  cloud_providers:
    - aws
    - azure
    - gcp
    - oci
  # Identity providers for discovery
  identity_providers:
    - okta
    - azure_ad
    - google_workspace
    - onelogin

# Performance tuning
performance:
  # Batch size for bulk operations
  batch_size: 1000
  # Memory limit per worker in MB
  memory_limit_mb: 512
  # Enable streaming for large files
  streaming_enabled: true
  # Chunk size for streaming in bytes
  stream_chunk_size: 65536
  # Enable compression for storage
  compression_enabled: true
  # Compression algorithm: gzip, lz4, zstd
  compression_algorithm: zstd
