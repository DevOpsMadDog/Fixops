# Enterprise Micro Pen Testing

Enterprise-grade micro penetration testing service optimized for rapid, focused security testing of microservices.

## Overview

The Enterprise Micro Pen Testing service provides:

- **Fast Execution**: Optimized for quick security assessments (typically < 1 second per test)
- **Microservice-Focused**: Designed specifically for testing microservices and APIs
- **Batch Operations**: Execute multiple tests in parallel with concurrency control
- **Enterprise Security**: Full authentication, audit logging, and rate limiting
- **Scalable**: Built for high-throughput testing scenarios

## Features

### Micro Pen Testing Profiles

1. **Quick Profile** (`quick`)
   - Minimal, fast testing
   - Basic security checks
   - Execution time: < 100ms
   - Best for: CI/CD pipelines, rapid assessments

2. **Standard Profile** (`standard`)
   - Comprehensive testing
   - Multiple vulnerability checks
   - Execution time: < 500ms
   - Best for: Regular security scans

3. **Deep Profile** (`deep`)
   - Thorough security assessment
   - Advanced vulnerability detection
   - Execution time: < 2s
   - Best for: Pre-production audits

### Supported Microservice Types

- API services (REST, GraphQL)
- Web applications
- gRPC services
- Message queue services
- Database services
- Cache services

## API Endpoints

All endpoints require authentication via Bearer token.

### Requests

- `GET /api/v1/micro-pentest/requests` - List micro pen test requests
- `POST /api/v1/micro-pentest/requests` - Create a new micro pen test request
- `GET /api/v1/micro-pentest/requests/{request_id}` - Get a specific request
- `POST /api/v1/micro-pentest/requests/{request_id}/execute` - Execute a test

### Batch Operations

- `POST /api/v1/micro-pentest/batches` - Create and execute a batch of tests

### Results

- `GET /api/v1/micro-pentest/results` - List all results
- `GET /api/v1/micro-pentest/results/{request_id}` - Get results for a request

### Summary

- `GET /api/v1/micro-pentest/summary` - Get summary statistics

## Usage Examples

### Create a Quick Test

```bash
curl -X POST "https://api.fixops.com/api/v1/micro-pentest/requests" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "service_name": "payment-api",
    "service_type": "api",
    "target_url": "https://payment-api.staging.example.com",
    "endpoints": ["/api/v1/payments", "/api/v1/refunds"],
    "test_profile": "quick",
    "priority": "high",
    "environment": "staging"
  }'
```

### Execute a Batch of Tests

```bash
curl -X POST "https://api.fixops.com/api/v1/micro-pentest/batches" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "requests": [
      {
        "service_name": "user-service",
        "service_type": "api",
        "target_url": "https://user-service.staging.example.com",
        "endpoints": ["/api/v1/users"],
        "test_profile": "quick"
      },
      {
        "service_name": "order-service",
        "service_type": "api",
        "target_url": "https://order-service.staging.example.com",
        "endpoints": ["/api/v1/orders"],
        "test_profile": "standard"
      }
    ]
  }'
```

### Get Summary Statistics

```bash
curl -X GET "https://api.fixops.com/api/v1/micro-pentest/summary?service_name=payment-api" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## Architecture

### Service Layer

The `MicroPenTestService` handles:
- Request management
- Test execution
- Result storage
- Batch processing with concurrency control

### Database Layer

The `MicroPenTestDB` provides:
- Request persistence
- Result storage
- Query capabilities

Currently uses in-memory storage but can be extended to use SQLite, PostgreSQL, etc.

## Security

- **Authentication**: All endpoints require Bearer token authentication
- **Audit Logging**: All operations are logged with structured logging
- **Rate Limiting**: Integrated with enterprise rate limiting middleware
- **Input Validation**: All inputs are validated using Pydantic models

## Performance

- **Concurrent Execution**: Up to 10 concurrent tests by default
- **Fast Timeouts**: 30-second timeout for micro tests
- **Optimized Execution**: Minimal overhead for rapid testing

## Integration

The micro pen testing service is integrated into the FixOps Enterprise API at:

```
/api/v1/micro-pentest/*
```

It follows the same patterns as other enterprise services:
- Authentication via `src.api.dependencies.authenticate`
- Structured logging via `structlog`
- Error handling with proper HTTP status codes

## Future Enhancements

- Database persistence (SQLite/PostgreSQL)
- Integration with external pen testing tools
- Real-time test execution monitoring
- Webhook notifications for test completion
- Test templates and presets
- Integration with CI/CD pipelines
